/*테이블 검색 */
SELECT 
    TC.OWNER AS "Owner",
    TC.TABLE_NAME AS "테이블ID",
    TAB_COMMENTS.COMMENTS AS "테이블명",
    TC.COLUMN_NAME AS "컬럼ID",
    CDC.COMMENTS AS "컬럼명",
    CASE WHEN TC.COLUMN_NAME IN (
        SELECT COLS.COLUMN_NAME
        FROM ALL_CONSTRAINTS CONS
        JOIN ALL_CONS_COLUMNS COLS ON CONS.CONSTRAINT_NAME = COLS.CONSTRAINT_NAME
        WHERE CONS.CONSTRAINT_TYPE = 'P'
        AND COLS.TABLE_NAME = TC.TABLE_NAME
        AND COLS.OWNER = TC.OWNER
    ) THEN 'Y' ELSE 'N' END AS "PK여부"    
FROM ALL_TAB_COLUMNS TC
LEFT JOIN ALL_COL_COMMENTS CDC ON TC.OWNER = CDC.OWNER AND TC.TABLE_NAME = CDC.TABLE_NAME AND TC.COLUMN_NAME = CDC.COLUMN_NAME
LEFT JOIN ALL_TAB_COMMENTS TAB_COMMENTS ON TC.OWNER = TAB_COMMENTS.OWNER AND TC.TABLE_NAME = TAB_COMMENTS.TABLE_NAME
WHERE 1=1 
AND TC.TABLE_NAME = '' -- 테이블ID 
--AND TAB_COMMENTS.COMMENTS = '' -- 테이블명
--AND TC.COLUMN_NAME = '' -- 컬럼ID
--AND CDC.COMMENTS = '' -- 컬럼명
ORDER BY TC.OWNER, TC.TABLE_NAME;

/* DB LINK 조회 */
SELECT DB_LINK, USERNAME, HOST, CREATED
FROM DBA_DB_LINKS
WHERE DB_LINK = '';

/* 작동 프로시저 조회 */
SELECT 
   OBJECT_NAME || '(' || TO_CHAR(LAST_DDL_TIME,'YYYYMMDD_HH24MISS') ||')' AS PROCEDURE_NAME,
   CASE WHEN STATUS ='VALID' THEN '정상' ELSE '비정상' END AS PROCEDURE_STATUS 
FROM DBA_OBJECTS 
WHERE OWNER = 'LM_ADM'
  AND OBJECT_TYPE = 'PROCEDURE' 
  AND TO_CHAR(LAST_DDL_TIME,'YYYYMMDD') >  '20230402' 
ORDER BY PROCEDURE_STATUS DESC, PROCEDURE_NAME ASC;

/* 프로시저 조회 */
SELECT  *
    FROM USER_PROCEDURES
    WHERE 1 = 1
    AND OBJECT_NAME = UPPER('프로시저명');


/* 프로시저 실행 */ 
EXEC 프로시저명('202303,5,,,,,,,,', 'TEST_MAN');

/* DB 파일 PATH */
SELECT *
  FROM DBA_DIRECTORIES
 WHERE DIRECTORY_PATH LIKE '%경로%';
 

/* 소스 조회 */  
SELECT OWNER, NAME, TYPE 
 FROM ALL_SOURCE
WHERE 1=1 
 AND OWNER !='SYS'
 AND TEXT LIKE '%BARC%' 
 AND TYPE ='FUNCTION'
 GROUP BY OWNER, NAME, TYPE  ;

/* 과거 데이터 조회 */
 -- 하루전
SELECT  *  FROM 테이블명   AS OF TIMESTAMP(SYSTIMESTAMP-INTERVAL '1' DAY)  
WHERE 조건   
;

-- 14시간전
SELECT *
  FROM 테이블명   AS OF TIMESTAMP (SYSTIMESTAMP - INTERVAL '14' HOUR)
 WHERE 조건
;
